<div class="row">
  <div class="col s12">
    <h3>Interests</h3>
    <table class="highlight">
      <thead>
      <tr>
        <th></th>
        <th>Name</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>      
      <% @profiles.each do |profile| %> 
        <tr class="profile-pictures">
          <td>
            <%= image_tag profile.images.first, size: '80x80' %>
          </td>
          <td>
            <%= profile.user.display_name.split(' ').first %>
          </td>
          <td>
            <a class="waves-effect waves-light" data-uuid="<%=profile.uuid%>" onclick="updateView(this, 'rejected', '<%= profile.uuid %>');"><i class="material-icons">delete</i></a>
          </td>
        </tr>
      <% end %>
    </tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    $('.carousel').carousel({numVisible: 3});
  });

  function removeProfile(self) {
    $('a[data-uuid=' + self.data.split("=")[1].split("&")[0] + ']').closest("tr").remove()
  }

  function checkForRedirect() {
    if ($('tr.profile-pictures').length == 0) {
      window.location.href = '/profiles';
    }
  }

  function updateView(elem, state, profile_uuid) {
    var data = {
      profile_id: profile_uuid,
      state: state
    };
    $.ajax({ url: '/views/' + profile_uuid,
      type: 'PUT',
      beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
      data: data,
      success: function(data, status, xhr) {
        removeProfile(this);
        checkForRedirect();
      },
      error: function(response) {
        M.toast({html: response.responseText, displayLength: 4500, classes: "red"})
      }
    });
  }
</script>